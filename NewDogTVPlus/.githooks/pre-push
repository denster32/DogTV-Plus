#!/bin/sh
# Pre-push hook for DogTV+ project
# This hook runs comprehensive checks before pushing to remote

set -e

echo "üöÄ Running pre-push checks..."

# Run full test suite
echo "üß™ Running comprehensive test suite..."
if ! swift test; then
    echo "‚ùå Test suite failed. Please fix all tests before pushing."
    exit 1
fi

# Check for TODO/FIXME comments in public API
echo "üìã Checking for unresolved TODOs in public APIs..."
if grep -r "TODO\|FIXME" Sources/ --include="*.swift" | grep -E "(public|open)" >/dev/null; then
    echo "‚ö†Ô∏è  Found TODO/FIXME comments in public APIs:"
    grep -r "TODO\|FIXME" Sources/ --include="*.swift" | grep -E "(public|open)"
    echo "   Consider resolving these before pushing to main branch."
fi

# Check package resolution
echo "üì¶ Verifying package dependencies..."
if ! swift package resolve; then
    echo "‚ùå Package dependency resolution failed."
    exit 1
fi

# Build for all supported platforms (if possible)
echo "üèóÔ∏è  Building for multiple platforms..."
for platform in macos tvos-simulator; do
    echo "   Building for $platform..."
    if ! swift build --triple arm64-apple-$platform; then
        echo "‚ùå Build failed for $platform"
        # Don't exit on platform build failure, just warn
        echo "‚ö†Ô∏è  Warning: Platform-specific build issue detected"
    fi
done

echo "‚úÖ All pre-push checks completed!"
exit 0
